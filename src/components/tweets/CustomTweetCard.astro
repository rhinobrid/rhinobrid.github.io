---
/**
 * Custom Tweet Card Component
 * 
 * Clean card-based design for displaying tweets.
 * 
 * Features:
 * - Author avatar and handle display
 * - Formatted date
 * - Tag support with hashtag links
 * - Hover effects and transitions
 * 
 * Forward Compatibility Note:
 * If astro-pure releases a built-in TweetCard component in the future,
 * consider migrating to their version via swizzling.
 */

import type { CollectionEntry } from 'astro:content'
import config from 'virtual:config'
import { getFormattedDate } from 'astro-pure/utils'

interface Props {
  tweet: CollectionEntry<'microposts'>
}

const { tweet } = Astro.props
const { data, id } = tweet
const tweetDate = data.publishDate

// Generate author handle from config
const authorHandle = config.author.toLowerCase().replace(/\s+/g, '')

const formattedDate = getFormattedDate(tweetDate, {
  year: 'numeric',
  month: 'long',
  day: 'numeric',
  hour: '2-digit',
  minute: '2-digit'
})

const fullDateTitle = new Date(tweetDate).toLocaleString(config.locale.dateLocale, {
  dateStyle: 'full',
  timeStyle: 'short'
})
---

<article
  id={`tweet-${id}`}
  class="border border-border bg-card rounded-xl px-4 py-4 mb-4 transition-all duration-200 hover:border-primary/30 hover:shadow-md"
>
  {/* Header: Avatar + Meta */}
  <header class="flex items-start gap-3 mb-4">
    <div class="flex-shrink-0">
      <img
        src={config.logo.src}
        alt={config.author}
        class="w-10 h-10 rounded-full object-cover"
        loading="lazy"
      />
    </div>
    
    <div class="flex-1 min-w-0">
      <div class="flex items-baseline gap-2 flex-wrap">
        <span class="font-bold text-foreground">{config.author}</span>
        <span class="text-muted-foreground text-sm">@{authorHandle}</span>
      </div>
      <time 
        datetime={tweetDate.toISOString()} 
        class="text-muted-foreground text-xs mt-1 block"
        title={fullDateTitle}
      >
        {formattedDate}
      </time>
    </div>
  </header>
  
  {/* Content */}
  <div class="text-lg leading-relaxed text-foreground/90 mb-2">
    <slot />
  </div>
  
  {/* Footer: Tags */}
  {data.tags.length > 0 && (
    <footer class="pt-0 border-t border-border/50">
      <div class="flex flex-wrap gap-2">
        {data.tags.map((tag: string) => (
          <a 
            href={`/tags/${tag}`} 
            class="text-primary text-sm hover:underline cursor-pointer transition-colors"
          >
            #{tag}
          </a>
        ))}
      </div>
    </footer>
  )}
</article>
