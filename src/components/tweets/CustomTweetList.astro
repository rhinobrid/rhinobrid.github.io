---
/**
 * Custom Tweet List Component
 * 
 * Groups tweets by year with large year overlays (similar to archives).
 * 
 * Features:
 * - Year-based grouping with large typography
 * - Sticky year headers
 * - Tweet count per year
 * - Responsive design
 * 
 * Forward Compatibility Note:
 * If astro-pure releases a built-in TweetList component in the future,
 * consider migrating to their version via swizzling.
 */

import type { CollectionEntry } from 'astro:content'
import { render } from 'astro:content'
import CustomTweetCard from './CustomTweetCard.astro'

interface Props {
  tweetsByYear: [number, CollectionEntry<'tweets'>[]][]
}

const { tweetsByYear } = Astro.props
---

<div class='custom-tweet-list'>
  {tweetsByYear.map(([year, tweets]) => (
    <div class='tweets-year-group' data-year={year}>
      <header class='year-header'>
        <h2 class='year-label'>{year}</h2>
        <span class='year-count'>{tweets.length} tweet{tweets.length !== 1 ? 's' : ''}</span>
      </header>
      
      <div class='tweets-container'>
        {tweets.map(async (tweet) => {
          const { Content } = await render(tweet)
          return (
            <a href={`/tweets/${tweet.id}`} class='tweet-link'>
              <CustomTweetCard tweet={tweet}>
                <Content />
              </CustomTweetCard>
            </a>
          )
        })}
      </div>
    </div>
  ))}
</div>

<style>
  .custom-tweet-list {
    @apply flex flex-col gap-8;
  }

  .tweets-year-group {
    @apply relative;
  }

  .year-header {
    @apply flex items-baseline gap-3 mb-4 sticky top-0 bg-background/80 backdrop-blur-sm py-2 z-10;
  }

  .year-label {
    @apply text-4xl font-bold text-transparent opacity-15 select-none;
    -webkit-text-stroke: 1px hsl(var(--foreground) / var(--un-text-opacity, 1));
  }

  .year-count {
    @apply text-muted-foreground text-sm uppercase tracking-wide;
  }

  .tweets-container {
    @apply flex flex-col gap-0;
  }
  
  .tweet-link {
    @apply no-underline text-foreground;
  }
  
  @media (min-width: 768px) {
    .year-label {
      @apply text-6xl;
      position: absolute;
      left: -3rem;
      top: -1rem;
      z-index: 0;
      pointer-events: none;
    }

    .year-header {
      @apply relative z-10;
    }

    .tweets-container {
      @apply relative z-10;
    }
  }
</style>
